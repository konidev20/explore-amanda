# Steps to build amanda from source on Rocky Linux 8

## Setup environment

### Clone the amanda git repository from GitHub

```
git clone git@github.com:zmanda/amanda.git
```

### Checkout to 3.5 branch

```
git checkout 3_5
```

### Update repositories

```
sudo yum update -y
```

### Install development tools

```
sudo yum groups mark install "Development Tools"
sudo yum groupinstall -y "Development Tools"
```

### Install dependencies

```
sudo yum install -y perl-ExtUtils-Embed curl perl-Thread-Queue glib2-devel automake perl-Data-Dumper perl-JSON perl-Encode-Locale xinetd libtirpc perl-IO-Socket-SSL perl-URI perl-XML-Simple libxslt openssl-devel libcurl-devel libtirpc-devel swig perl-devel libxslt docbook-xsl gnuplot mailx 
```

### Install Powertools to get rpcgen

```
sudo dnf install epel-release
sudo dnf config-manager --set-enabled powertools
sudo dnf update
sudo dnf rpcgen
```

## Create the amandabackup user

```
sudo useradd amandabackup
```

### Give root access to the amandabackup user

```
sudo usermod -a -G root amandabackup
```

## Prepare build using automake

```
./autogen run /config/set_full_version
```

## Run configure to generate Makefiles

```
./configure --prefix="/usr" --docdir="/usr/share/amanda/doc/amanda" --htmldir="/usr/share/amanda/doc/amanda/html" --pdfdir="/usr/share/amanda/doc/amanda/pdf" --sysconfdir="/etc" --localstatedir="/var" --sharedstatedir="/var/lib" --libdir="/usr/lib64" --disable-static --disable-dependency-tracking --enable-as-needed --disable-rpath --with-user="amandabackup" --with-group="amandabackup" --with-configdir="/etc/amanda" --with-gnutar-listdir="/var/lib/amanda/gnutar-lists" --with-fqdn --with-low-tcpportrange="800,840" --with-tcpportrange="11000,11040" --with-udpportrange="800,840" --with-debugging="/var/log/amanda" --with-index-server="localhost" --with-amandates="/var/lib/amanda/amandates" --with-security-file="/etc/amanda4/amanda-security.conf" --with-amdatadir="/var/lib/amanda" --with-bsdtcp-security --with-bsdudp-security --with-ssh-security --enable-manpage-build
```

## Install 3.5.4 amanda

```
sudo make install
```

## Uninstall 3.5.4 amanda

```
sudo make uninstall
```

## Clean the object files and binaries

```
make clean
```

## Clean files generated by ./configure

```
make distclean
```

## Clean git branch

```
git clean -f
```
