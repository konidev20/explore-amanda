# Steps to build amanda from source on Ubuntu 22.04LTS

## Setup environment

### Clone the amanda git repository from GitHub

```
git clone git@github.com:zmanda/amanda.git
```

### Checkout to 3.5 branch

```
git checkout 3_5
```

### Update repositories

```
sudo apt update
```

### Install development tools

```
sudo apt install -y build-essential
```

### Install dependencies

```
sudo apt install -y devscripts bison perl libextutils-cbuilder-perl curl libthread-queue-any-perl libglib2.0-dev automake libdata-dumper-simple-perl libjson-perl libencode-locale-perl xinetd libtirpc3 libio-socket-ssl-perl liburi-perl libxml-simple-perl libxslt1.1 xsltproc libssl-dev libcurl4-openssl-dev libperl-dev docbook-xsl mailutils swig flex byacc gnuplot
```

## Create the amandabackup user

```
sudo useradd amandabackup
```

### Give root access to the amandabackup user

```
sudo usermod -a -G root amandabackup
```

## Prepare build using automake

```
./autogen run /config/set_full_version
```

## Run configure to generate Makefiles

```
./configure --prefix="/usr" --docdir="/usr/share/amanda/doc/amanda" --htmldir="/usr/share/amanda/doc/amanda/html" --pdfdir="/usr/share/amanda/doc/amanda/pdf" --sysconfdir="/etc" --localstatedir="/var" --sharedstatedir="/var/lib" --libdir="/usr/lib64" --disable-static --disable-dependency-tracking --enable-as-needed --disable-rpath --with-user="amandabackup" --with-group="amandabackup" --with-configdir="/etc/amanda" --with-gnutar-listdir="/var/lib/amanda/gnutar-lists" --with-fqdn --with-low-tcpportrange="800,840" --with-tcpportrange="11000,11040" --with-udpportrange="800,840" --with-debugging="/var/log/amanda" --with-index-server="localhost" --with-amandates="/var/lib/amanda/amandates" --with-security-file="/etc/amanda4/amanda-security.conf" --with-amdatadir="/var/lib/amanda" --with-bsdtcp-security --with-bsdudp-security --with-ssh-security --enable-manpage-build
```

## Install 3.5.4 amanda

```
sudo make install
```

## Check if everything is working
TODO: Getting started with amanda, basic backup and restore

## Cleanup

### Uninstall 3.5.4 amanda

```
sudo make uninstall
```

### Clean the object files and binaries

```
make clean
```

### Clean files generated by ./configure

```
make distclean
```

### Clean git branch

```
git clean -f
```